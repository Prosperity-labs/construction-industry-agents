graph TB
    subgraph "UPSTREAM WORKFLOW"
        REVIT[ğŸ¢ Revit 3D Model<br/>Architectural design]
        PARAMS[ğŸ“‹ Custom Parameters<br/>â€¢ Description<br/>â€¢ Unit of measure<br/>â€¢ Quantity<br/>â€¢ Specifications<br/>â€¢ Materials]
        SCHEDULE[ğŸ“Š Revit Schedule<br/>Export to Excel]
        REVIT --> PARAMS
        PARAMS --> SCHEDULE
    end
    
    subgraph "PRESENTATION LAYER"
        WEB[ğŸŒ Web Interface<br/>Streamlit/React]
        API[ğŸ”Œ REST API<br/>FastAPI]
        DASH[ğŸ“Š Analytics Dashboard<br/>Real-time monitoring]
    end
    
    subgraph "ORCHESTRATION LAYER"
        ORCH[ğŸ¯ Main Orchestrator<br/>Workflow management]
        QUEUE[âš¡ Task Queue<br/>Celery + Redis]
        SCHED[â° Scheduler<br/>Cron jobs & triggers]
    end
    
    subgraph "AGENT LAYER - CORE PROCESSING"
        A1[ğŸ“Š Excel Parser Agent<br/>âœ… READY<br/>â€¢ Multi-format support<br/>â€¢ Serbian language<br/>â€¢ Auto-categorization<br/>â€¢ OpenAI enhanced]
        
        A2[ğŸ­ Supplier Mapping Agent<br/>ğŸ”§ TO BUILD<br/>â€¢ Supplier database<br/>â€¢ Smart matching<br/>â€¢ Performance ranking]
        
        A3[ğŸ“¤ Communication Agent<br/>ğŸ”§ TO BUILD<br/>â€¢ Multi-channel sending<br/>â€¢ Template engine<br/>â€¢ Response tracking]
        
        A4[ğŸ“¥ Response Parser Agent<br/>ğŸ”§ TO BUILD<br/>â€¢ Email parsing<br/>â€¢ PDF extraction<br/>â€¢ Price validation]
        
        A5[ğŸ§® Quote Calculator Agent<br/>ğŸ”§ TO BUILD<br/>â€¢ Price optimization<br/>â€¢ Margin calculation<br/>â€¢ Timeline planning]
        
        A6[ğŸ“„ Document Generator<br/>ğŸ”§ TO BUILD<br/>â€¢ PDF generation<br/>â€¢ Excel exports<br/>â€¢ Professional formatting]
    end
    
    subgraph "INTELLIGENCE LAYER"
        ML1[ğŸ§  Category Classifier<br/>NLP + Keywords]
        ML2[ğŸ“ˆ Price Predictor<br/>Historical analysis]
        ML3[âš ï¸ Anomaly Detector<br/>Price validation]
        ML4[ğŸ¯ Supplier Ranker<br/>Performance ML]
    end
    
    subgraph "INTEGRATION LAYER"
        INT1[ğŸ“§ Email Service<br/>SMTP/IMAP<br/>Gmail/Outlook APIs]
        INT2[ğŸ”— Supplier APIs<br/>REST integrations<br/>Authentication]
        INT3[ğŸ•·ï¸ Web Scraping<br/>Selenium/Scrapy<br/>Anti-detection]
        INT4[ğŸ” OCR Service<br/>Tesseract<br/>Cloud Vision API]
    end
    
    subgraph "DATA LAYER"
        DB1[(ğŸ“¦ Main Database<br/>PostgreSQL<br/>Projects, Items, Quotes)]
        DB2[(âš¡ Cache<br/>Redis<br/>Session data, Temp results)]
        DB3[ğŸ“ File Storage<br/>MinIO/S3<br/>Excel files, PDFs, Images]
        DB4[(ğŸ‘¥ Supplier DB<br/>Contact info<br/>Performance metrics)]
        DB5[(ğŸ’° Price History<br/>Time-series data<br/>Market trends)]
    end
    
    subgraph "MONITORING & SECURITY"
        MON1[ğŸ“‹ Logging<br/>Structured logs<br/>Error tracking]
        MON2[ğŸ“Š Metrics<br/>Processing times<br/>Success rates]
        MON3[ğŸš¨ Alerts<br/>Failed requests<br/>System errors]
        SEC1[ğŸ”’ Authentication<br/>JWT tokens<br/>Role-based access]
        SEC2[ğŸ›¡ï¸ Rate Limiting<br/>API protection<br/>DDoS prevention]
    end
    
    %% Upstream flow
    SCHEDULE --> WEB
    SCHEDULE --> A1
    
    %% Flow connections
    WEB --> API
    API --> ORCH
    ORCH --> QUEUE
    
    QUEUE --> A1
    A1 --> A2
    A2 --> A3
    A3 --> A4
    A4 --> A5
    A5 --> A6
    
    %% Intelligence connections
    A1 --> ML1
    A2 --> ML4
    A4 --> ML2
    A4 --> ML3
    A5 --> ML2
    
    %% Integration connections
    A3 --> INT1
    A3 --> INT2
    A3 --> INT3
    A4 --> INT4
    
    %% Data connections
    A1 --> DB1
    A1 --> DB3
    A2 --> DB4
    A3 --> DB2
    A4 --> DB5
    A5 --> DB1
    A6 --> DB3
    
    %% Monitoring connections
    ORCH --> MON1
    A1 --> MON2
    A3 --> MON2
    A4 --> MON2
    MON1 --> MON3
    
    %% Security
    API --> SEC1
    API --> SEC2
    
    %% Styling
    style A1 fill:#c8e6c9,stroke:#4caf50,stroke-width:3px
    style A2 fill:#ffcdd2,stroke:#f44336,stroke-width:2px
    style A3 fill:#ffcdd2,stroke:#f44336,stroke-width:2px
    style A4 fill:#ffcdd2,stroke:#f44336,stroke-width:2px
    style A5 fill:#ffcdd2,stroke:#f44336,stroke-width:2px
    style A6 fill:#ffcdd2,stroke:#f44336,stroke-width:2px
    
    style ORCH fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style QUEUE fill:#e8f5e8,stroke:#4caf50,stroke-width:2px